<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>PetIBM: Installation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PetIBM
   &#160;<span id="projectnumber">0.4.1</span>
   </div>
   <div id="projectbrief">Toolbox and applications of the immersed-boundary method for distributed-memory architectures</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="md_CHANGELOG.html"><span>Change&#160;Log</span></a></li>
      <li><a href="md_CONTRIBUTING.html"><span>Contributing</span></a></li>
      <li><a href="usergroup0.html"><span>Quick&#160;Start</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_doc_markdowns_installation.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Installation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Dependencies (last tested)</h2>
<p><b>Required</b>:</p>
<ul>
<li>GNU C++ compiler g++: v4.9.2, v5.4.0, and v7.2.1 have been tested</li>
<li><a href="https://www.mcs.anl.gov/petsc/">PETSc</a>: v3.8.1 or above; with HDF5 enabled</li>
<li>MPI: OpenMPI, MPICH, and Intel MPI have been tested</li>
<li><a href="https://github.com/jbeder/yaml-cpp">yaml-cpp</a></li>
<li><a href="https://github.com/google/googletest">gtest</a></li>
</ul>
<p><b>Optional for GPU linear solvers</b>:</p>
<ul>
<li><a href="https://github.com/NVIDIA/AMGX">AmgX</a></li>
<li><a href="https://github.com/barbagroup/AmgXWrapper">AmgXWrapper</a> (v1.3)</li>
</ul>
<p><b>Optional for pre- and post-processing scripts</b>:</p>
<ul>
<li>Python (3.6)</li>
<li>Numpy (1.12.1)</li>
<li>H5py (2.7.0)</li>
<li>Matplotlib (2.0.2)</li>
</ul>
<p><b>Note</b>:</p>
<ul>
<li>MPI can be either installed during <a href="#petsc">PETSc configuration</a> or installed explicitly by users.</li>
<li><a href="https://github.com/jbeder/yaml-cpp">yaml-cpp</a>, <a href="https://github.com/google/googletest">gtest</a>, and <a href="https://github.com/barbagroup/AmgXWrapper">AmgXWrapper</a> can be automatically installed during PetIBM configuration or explicitly installed by users in advance.</li>
<li>PetIBM has been tested on:<ul>
<li>Ubuntu 16.04 with g++-5.4, and PETSc-3.8.1</li>
<li>MacOS Sierra with g++-6.0, and PETSc-3.8.2</li>
<li>Arch Linux with g++-7.2, and PETSc-3.8.2</li>
</ul>
</li>
<li>PetIBM has also been tested on the following HPC systems:<ul>
<li><a href="https://colonialone.gwu.edu/">GW ColonialOne</a></li>
<li><a href="https://www.olcf.ornl.gov/titan/">Titan</a> at ORNL <hr/>
</li>
</ul>
</li>
</ul>
<h2>GNU C++ Compiler (<code>g++</code>)</h2>
<p>On Ubuntu, install <code>g++</code> using the following command: </p><pre class="fragment">sudo apt-get install g++
</pre><p>Check the version of G++ installed: </p><pre class="fragment">g++ --version
</pre><p>On Mac OS X, <code>g++</code> can be installed on Mac OS X via XCode or <a href="brew.sh">Homebrew</a>. </p><hr/>
<h2>PETSc</h2>
<p>PetIBM relies on the data structures and parallel routines of the PETSc library.</p>
<p>Install PETSc-3.8 in debugging mode and/or optimized mode. The debug mode is recommended during development, while the optimized mode should be used for production runs.</p>
<p>Get and unpack PETSc: </p><pre class="fragment">cd $HOME/sfw
mkdir -p petsc/3.8.1
wget http://ftp.mcs.anl.gov/pub/petsc/release-snapshots/petsc-lite-3.8.1.tar.gz
tar -xvf petsc-lite-3.8.1.tar.gz -C petsc/3.8.1 --strip-components=1
cd petsc/3.8.1
</pre><p>Configure and build an debugging version of PETSc: </p><pre class="fragment">export PETSC_DIR=$HOME/sfw/petsc/3.8.1
export PETSC_ARCH=linux-dbg
./configure --PETSC_DIR=$PETSC_DIR --PETSC_ARCH=$PETSC_ARCH \
    --with-cc=gcc \
    --with-cxx=g++ \
    --with-fc=gfortran \
    --COPTFLAGS="-O0" \
    --CXXOPTFLAGS="-O0" \
    --FOPTFLAGS="-O0" \
    --with-debugging=1 \
    --download-fblaslapack \
    --download-openmpi \
    --download-hdf5
make all
make test
</pre><p>If you do not have a Fortran compiler ready, you use the following configuration: </p><pre class="fragment">./configure --PETSC_ARCH=$PETSC_ARCH \
    --with-cc=gcc \
    --with-cxx=g++ \
    --COPTFLAGS="-O0" \
    --CXXOPTFLAGS="-O0" \
    --with-debugging=1 \
    --download-f2cblaslapack \
    --download-openmpi \
    --download-hdf5
</pre><p>Configure and build an optimized version of PETSc: </p><pre class="fragment">export PETSC_DIR=$HOME/sfw/petsc/3.8.1
export PETSC_ARCH=linux-opt
./configure --PETSC_DIR=$PETSC_DIR --PETSC_ARCH=$PETSC_ARCH \
    --with-cc=gcc \
    --with-cxx=g++ \
    --with-fc=gfortran \
    --COPTFLAGS="-O3" \
    --CXXOPTFLAGS="-O3" \
    --FOPTFLAGS="-O3" \
    --with-debugging=0 \
    --download-fblaslapack \
    --download-openmpi \
    --download-hdf5
make all
make test
</pre><p>When running the code on an external cluster, make sure that you compile PETSc with the MPI that has been configured to work with the cluster. Hence, <b>do not use the <code>--download-openmpi</code> flag</b>, but instead point to the folder with the MPI compilers and executables using the <code>--with-mpi-dir</code> flag. If BLAS and LAPACK are already installed in the system, you can point to the libraries using the <code>--with-blas-lib</code> and <code>--with-lapack-lib</code> flags.</p>
<p><a href="http://www.mcs.anl.gov/petsc/documentation/installation.html">Detailed instructions</a> with more options to customize your installation can be found on the PETSc website. Run <code>./configure --help</code> in the PETSc root directory to list all the available configure flags.</p>
<p>The PETSc Users Manual and the Manual Pages can be found on their <a href="http://www.mcs.anl.gov/petsc/documentation/index.html">documentation page</a>. </p><hr/>
<h2>yaml-cpp</h2>
<p><a href="https://github.com/jbeder/yaml-cpp">yaml-cpp</a> is a <a class="el" href="d7/d1e/namespace_y_a_m_l.html">YAML</a> parser in C++ used in PetIBM to parse the input configuration file.</p>
<p>The PetIBM configuration script gives the possibility to use a previously installed version of yaml-cpp (with the configuration argument <code>--with-yamlcpp-dir=&lt;path&gt;</code>, or <code>--with-yamlcpp-include=&lt;path&gt;</code> and <code>--with-yamlcpp-lib=&lt;path&gt;</code>) or to download and install yaml-cpp-0.6.2 (with <code>--enable-yamlcpp</code>). </p><hr/>
<h2>gtest</h2>
<p>We use Google's C++ test framework <a href="https://github.com/google/googletest">gtest</a> to run unit-tests after compiling PetIBM. When configuring PetIBM, you can either use a previously installed version of gtest and provide the path of the directory of the gtest installation with <code>--with-gtest-dir=&lt;path&gt;</code> (or using <code>--with-gtest-include=&lt;path&gt;</code> and <code>--with-gtest-lib=&lt;path&gt;</code>) or request to download and install gtest-1.7.0 with <code>--enable-gtest</code>. </p><hr/>
<h2>PetIBM</h2>
<p>Create a local copy of the PetIBM repository: </p><pre class="fragment">cd $HOME/sfw
mkdir petibm &amp;&amp; cd petibm
git clone https://github.com/barbagroup/PetIBM.git
export PETIBM_DIR=$HOME/sfw/petibm/PetIBM
</pre><p>You can set the environment variable <code>PETIBM_DIR</code> to your <code>$HOME/.bashrc</code> or <code>$HOME/.bash_profile</code> files by adding the line: </p><pre class="fragment">export PETIBM_DIR=$HOME/sfw/petibm/PetIBM
</pre><p>and restart you terminal or source the file: </p><pre class="fragment">source $HOME/.bashrc
</pre><p>Note: if you are using C shell, use the <code>setenv</code> command instead of <code>export</code>.</p>
<p>Configure and build PetIBM with PETSc in debugging mode: </p><pre class="fragment">PETSC_DIR=$HOME/sfw/petsc/3.8.1
PETSC_ARCH=linux-dbg
mkdir petibm-linux-dbg &amp;&amp; cd petibm-linux-dbg
$PETIBM_DIR/configure \
    --prefix=$HOME/sfw/petibm/petibm-linux-dbg \
    CXX=$PETSC_DIR/$PETSC_ARCH/bin/mpicxx \
    CXXFLAGS="-g -O0 -Wall -Wno-deprecated -std=c++14" \
    --with-petsc-dir=$PETSC_DIR \
    --with-petsc-arch=$PETSC_ARCH \
    --with-yamlcpp-dir=&lt;path&gt; \
    --with-gtest-dir=&lt;path&gt;
make all
make check
make install
</pre><p>If yaml-cpp and/or gtest are not available, you can request installation at configuration time using: </p><pre class="fragment">$PETIBM_DIR/configure \
    --prefix=$HOME/sfw/petibm/petibm-linux-dbg \
    CXX=$PETSC_DIR/$PETSC_ARCH/bin/mpicxx \
    CXXFLAGS="-g -O0 -Wall -Wno-deprecated -std=c++14" \
    --enable-yamlcpp \
    --enable-gtest
</pre><p>For production runs, you may want to use the optimized build of PETSc:</p>
<p>You may also want to build a optimized version: </p><pre class="fragment">PETSC_DIR=$HOME/sfw/petsc/3.8.1
PETSC_ARCH=linux-opt
mkdir petibm-linux-opt &amp;&amp; cd petibm-linux-opt
$PETIBM_DIR/configure \
    --prefix=$HOME/sfw/petibm/petibm-linux-opt \
    CXX=$PETSC_DIR/$PETSC_ARCH/bin/mpicxx \
    CXXFLAGS="-O3 -Wall -Wno-deprecated -std=c++14" \
    --with-petsc-dir=$PETSC_DIR \
    --with-petsc-arch=$PETSC_ARCH \
    --with-yamlcpp-dir=&lt;path&gt; \
    --with-gtest-dir=&lt;path&gt;
make all
make check
make install
</pre><p>Et voila! You can now add the <code>bin</code> directory (that contains the executables) to you PATH environment variable: </p><pre class="fragment">export PATH=$HOME/sfw/petibm/petibm-linux-opt/bin:$PATH
</pre><hr/>
<h2>PetIBM examples</h2>
<p>We provide some examples! Input files are located in <code>$PETIBM_DIR</code>, but can be copied to another directory with </p><pre class="fragment">make copy-examples EXAMPLES_DIR=&lt;directory&gt;
</pre><p><code>EXAMPLES_DIR</code> is optional and the default directory is the folder <code>examples</code> in the top build directory. </p><hr/>
<h2>Optional: using NVIDIA AmgX to solve linear systems on multiple GPUs</h2>
<p>PetIBM implements the possibility to solve linear systems on CUDA-capable GPU devices using the NVIDIA <a href="https://github.com/NVIDIA/AMGX">AmgX</a> library.</p>
<p>To solve linear systems on multiple GPU devices with PetIBM, the user must install CUDA and AmgX before building PetIBM and use the configuration arguments <code>--with-cuda-dir=&lt;path&gt;</code> for CUDA and <code>--with-amgx-dir=&lt;path&gt;</code> (or <code>--with-amgx-include=&lt;path&gt;</code> and <code>--with-amgx-lib=&lt;path&gt;</code>) for AmgX.</p>
<p>To handle the data conversion between PETSc and AmgX, we use our in-house wrapper, called <a href="https://github.com/barbagroup/AmgXWrapper">AmgXWrapper</a>. When configuring PetIBM, you can either use a previously installed version of AmgXWrapper and provide the path of the directory of the AmgXWrapper installation with <code>--with-amgxwrapper-dir=&lt;path&gt;</code> (or using <code>--with-amgxwrapper-include=&lt;path&gt;</code> and <code>--with-amgxwrapper-lib=&lt;path&gt;</code>) or request to download and install AmgXWrapper-1.4 with <code>--enable-amgxwrapper</code>.</p>
<p>For example, to build an optimized version of PetIBM with CUDA, AmgX, and AmgXWrapper: </p><pre class="fragment">PETSC_DIR=$HOME/sfw/petsc/3.8.1
PETSC_ARCH=linux-opt
mkdir petibm-linux-opt &amp;&amp; cd petibm-linux-opt
$PETIBM_DIR/configure \
    --prefix=$HOME/sfw/petibm/petibm-linux-opt \
    CXX=$PETSC_DIR/$PETSC_ARCH/bin/mpicxx \
    CXXFLAGS="-O3 -Wall -Wno-deprecated -std=c++14" \
    --with-petsc-dir=$PETSC_DIR \
    --with-petsc-arch=$PETSC_ARCH \
    --with-yamlcpp-dir=&lt;path&gt; \
    --with-gtest-dir=&lt;path&gt; \
    --with-cuda-dir=&lt;path&gt; \
    --with-amgx-dir=&lt;path&gt; \
    --with-amgxwrapper-dir=&lt;path&gt;
make all
make check
make install
</pre><hr/>
<h2>Contributing and reporting bugs</h2>
<p>To report bugs, please use the GitHub issue tracking system. We are also open to pull-requests. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Jun 6 2019 18:53:50 for PetIBM by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
